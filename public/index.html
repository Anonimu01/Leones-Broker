<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Leones Broker — Tu Puerta al Mercado Global</title>
<meta name="description" content="Leones Broker - Plataforma de trading. Público y área privada." />

<!-- FONT AWESOME (necesario para los íconos del bloque de depósito) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background:#0b0b0b;color:#e9e6e1;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    line-height:1.45;overflow-x:hidden;
  }
  :root{ --gold:#cfa240; --muted:#bfc6c9; --card:#141414; }

  img{display:block;max-width:100%;height:auto;object-fit:cover}
  a{color:var(--gold);text-decoration:none}

  header{
    position:fixed;top:0;left:0;right:0;height:72px;z-index:1400;
    display:flex;align-items:center;justify-content:space-between;padding:12px 22px;
    background:linear-gradient(180deg, rgba(11,11,11,0.75), rgba(11,11,11,0.22));
    backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03)
  }
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:44px;width:auto;object-fit:contain}
  .brand h1{margin:0;font-size:18px;color:var(--gold);font-weight:800}
  .nav-actions{display:flex;gap:10px;align-items:center}
  .btn{background:var(--gold);color:#111;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--gold);border:2px solid rgba(207,162,67,0.12)}
  /* Glow animation for prominent CTA */
  .glow {
    box-shadow: 0 0 8px rgba(207,162,67,0.9), 0 0 20px rgba(207,162,67,0.18) inset;
    animation: pulseGlow 2.6s infinite ease-in-out;
  }
  @keyframes pulseGlow {
    0% { box-shadow: 0 0 6px rgba(207,162,67,0.7), 0 0 12px rgba(207,162,67,0.12) inset; transform: translateY(0); }
    50% { box-shadow: 0 0 12px rgba(207,162,67,0.95), 0 0 26px rgba(207,162,67,0.18) inset; transform: translateY(-1px); }
    100% { box-shadow: 0 0 6px rgba(207,162,67,0.7), 0 0 12px rgba(207,162,67,0.12) inset; transform: translateY(0); }
  }

  main{width:100%;margin:0;padding-top:88px}
  /* CONTENIDO AOCUPAR TODA LA PÁGINA */
  .container{width:100%;max-width:none;margin:0;padding:24px} /* cambiado para ocupar página completa */

  /* Hero */
  .hero-strip{position:relative;height:56vh;min-height:420px;display:flex;align-items:center;overflow:hidden}
  .hero-strip .bg{position:absolute;inset:0;z-index:1;overflow:hidden}
  .hero-strip .bg img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:contrast(1.02) saturate(.9)}
  .hero-content{position:relative;z-index:3;width:100%;display:flex;align-items:center}
  .hero-inner{display:grid;grid-template-columns:1fr 480px;gap:28px;align-items:center;width:100%;padding:24px}
  .hero-text{color:#f6efe6;text-align:left;padding:20px;background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.06));border-radius:12px}
  .hero-text h2{margin:0;color:var(--gold);font-size:clamp(28px,5vw,56px);line-height:1.03;font-weight:800}
  .hero-text p.lead{margin:12px 0 0;color:var(--muted);font-size:clamp(14px,1.6vw,20px)}
  .cta-group{margin-top:18px;display:flex;gap:12px;flex-wrap:wrap}
  .hero-visual{border-radius:12px;overflow:hidden;box-shadow:0 18px 60px rgba(0,0,0,0.6)}
  .hero-visual img{width:100%;height:56vh;min-height:320px;object-fit:cover}

  /* Sections */
  h3{color:var(--gold);font-size:28px;margin:0 0 12px}
  h4{color:var(--gold);margin:0 0 8px}
  p{margin:0;color:var(--muted);line-height:1.6}

  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .card .thumb{width:100%;height:140px;border-radius:8px;overflow:hidden}

  /* Accent cards (mobile look) */
  .card-list{display:flex;flex-direction:column;gap:16px}
  .accent-card{background:var(--card);border-radius:12px;padding:20px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.02)}
  .accent-card::before{content:"";position:absolute;left:0;top:12px;bottom:12px;width:12px;border-radius:8px;background:linear-gradient(180deg,#D9B34A,#C79E40)}

  /* Private area */
  .private-wrapper{display:flex;min-height:calc(100vh - 72px);background:linear-gradient(180deg,#0f0f0f,#0d0d0d)}
  .private-aside{width:260px;background:#0c0c0c;border-right:1px solid rgba(255,255,255,0.02);padding:18px;position:fixed;top:72px;bottom:0;left:0}
  .private-main{margin-left:280px;flex:1;padding:28px;max-width:1200px}
  .menu-item{display:block;padding:10px 12px;border-radius:8px;color:var(--muted);margin-bottom:6px;cursor:pointer}
  .menu-item.active{background:rgba(207,162,67,0.08);color:var(--gold);font-weight:700}

  footer{padding:28px 24px;text-align:center;color:var(--muted)}

  /* modal */
  #modal{display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.65);z-index:3000}
  #modal .box{width:100%;max-width:780px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#0b0b0b,#121212);border:1px solid rgba(255,255,255,0.03)}

  /* fallback */
  .img-fallback{display:flex;align-items:center;justify-content:center;background:#121212;color:var(--muted);height:140px;border-radius:8px;padding:10px;text-align:center}

  @media (max-width:900px){
    .hero-inner{grid-template-columns:1fr}
    .hero-visual img{height:40vh;min-height:200px}
    .grid-3{grid-template-columns:1fr}
    .private-aside{position:static;width:100%;margin-bottom:12px}
    .private-main{margin-left:0}
    .container{padding:18px}
    .hero-inner{padding:16px}
  }

  /* =========================
     BLOQUE: Deposita y Retira (estilos añadidos del bloque)
     ========================= */
  .deposit-section {
      padding: 40px 0 60px 0;
      background-color: var(--background, #0b0b0b);
      color: #e9e6e1;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  .deposit-title {
      text-align: left;
      font-size: 2rem;
      font-weight: 400;
      color: var(--gold);
      margin-bottom: 18px;
  }
  .deposit-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 30px;
      flex-wrap: wrap;
  }
  .info-column { flex:1; max-width:380px; padding:0 12px; }
  .info-item { margin: 18px 0; line-height:1.5; }
  .item-title { font-size:1.2rem; font-weight:600; margin-bottom:6px; color:#fff }
  .item-description { font-size:1rem; color:var(--muted) }
  .deposit-footer { text-align:left;color:var(--muted);margin-top:20px;font-size:0.9rem }

  .circle-chart {
      position: relative;
      width: 380px;
      height: 380px;
      border-radius: 50%;
      background-color: transparent;
      flex-shrink: 0;
      margin: 0 20px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
  }
  @media (max-width: 500px) {
      .circle-chart { width: 300px; height: 300px; margin: 0 auto; }
      .info-column { max-width:100%; text-align:center; }
  }
  .center-circle {
      position:absolute; top:50%; left:50%; width:160px; height:160px; border-radius:50%;
      transform:translate(-50%,-50%); background-color:var(--center-color, #0b0b0b); z-index:2;
  }
  .segment {
      --segment-size:50%;
      position:absolute; width:var(--segment-size); height:var(--segment-size);
      background-color:var(--segment-color, #333333); display:flex; justify-content:center; align-items:center;
      color:#fff; font-size:2em; z-index:1; box-sizing:border-box; border:1px solid rgba(0,0,0,0.2);
  }
  .segment-1 { top:0; left:0; }
  .segment-2 { top:0; right:0; }
  .segment-3 { bottom:0; right:0; }
  .segment-4 { bottom:0; left:0; }
  .segment-5 { bottom:0; left:0; }
  .segment i { color:#e9e6e1; position:absolute; font-size:1.6em; }
  /* End deposit block styles */
</style>
</head>
<body>

<header>
  <div class="brand">
    <img id="logoImg" src="/imge.img/logo leones.avif" alt="Leones Broker logo" onerror="this.style.display='none'"/>
    <h1>Leones Broker</h1>
  </div>
  <div class="nav-actions" id="headerActions">
    <!-- Added glow class to highlight these buttons -->
    <button class="btn glow" id="openAccountBtn">Abrir Cuenta</button>
    <button class="btn ghost glow" id="loginBtn">Iniciar Sesión</button>
  </div>
</header>

<main id="publicMain">

  <!-- HERO -->
  <section class="hero-strip" aria-label="Hero">
    <div class="bg"><img src="" alt="Hero banner" onerror="this.style.display='none'"></div>

    <div class="hero-content container">
      <div class="hero-inner">
        <div class="hero-text">
          <!-- EXACT TEXT (intro) -->
          <h2>Bienvenido a Leones Broker:<br>Tu Puerta al Mercado Global</h2>
          <p class="lead">Descubre un mundo de oportunidades con nuestra plataforma de trading avanzada. ¡Regístrate hoy y comienza tu viaje financiero!</p>

          <div class="cta-group">
            <!-- also glowing CTAs -->
            <button class="btn glow" id="ctaAbrir">Abrir Cuenta</button>
            <button class="btn ghost glow" id="ctaLogin">Iniciar Sesión</button>
          </div>
        </div>

        <div class="hero-visual" aria-hidden="true">
          <img src="/imge.img/cc80JmF0w-yls-Phj6T3e.jpg" alt="Visual" onerror="this.style.display='none'">
        </div>
      </div>
    </div>
  </section>

  <!-- EXPLORA LOS MERCADOS -->
  <section style="padding:36px 0;background:#0d0d0d">
    <div class="container">
      <h3>Explora los Mercados que Te Mueven</h3>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:14px">
        <div class="card">
          <div class="thumb">
            <img src="/imge.img/tgZ6DN5F0VWApXkvuUqkv.jpg" alt="Forex" onerror="this.style.display='none'">
          </div>
          <h4>Forex</h4>
          <p>Opera con las principales divisas globales.</p>
        </div>

        <div class="card">
          <div class="thumb">
            <img src="/imge.img/2IBw_mVFi2j9_lZ0B5drJ.jpg" alt="Criptomonedas" onerror="this.style.display='none'">
          </div>
          <h4>Criptomonedas</h4>
          <p>Invierte en el futuro del dinero digital.</p>
        </div>

        <div class="card">
          <div class="thumb">
            <img src="/imge.img/wDJ7kLiUHiwmQUy0WTa3y.jpg" alt="Índices" onerror="this.style.display='none'">
          </div>
          <h4>Índices</h4>
          <p>Accede a los principales mercados bursátiles del mundo.</p>
        </div>

        <div class="card">
          <div class="thumb">
            <img src="/imge.img/M6y8BjWWbmAp6xTqxhV6m.jpg" alt="Materias Primas" onerror="this.style.display='none'">
          </div>
          <h4>Materias Primas</h4>
          <p>Desde el oro y la plata hasta el petróleo y el gas.</p>
        </div>

        <div class="card">
          <div class="thumb">
            <img src="/imge.img/SblHxbuPnj0bDONBbTJKq.jpg" alt="Acciones y ETFs" onerror="this.style.display='none'">
          </div>
          <h4>Acciones y ETFs</h4>
          <p>Participa en el crecimiento de las empresas líderes.</p>
        </div>

        <div class="card">
          <div class="thumb">
            <img src="/imge.img/x5n0qkWTef4rcYY3qNxyu.jpg" alt="CFDs y Futuros" onerror="this.style.display='none'">
          </div>
          <h4>CFDs y Futuros</h4>
          <p>Maximiza tus oportunidades con instrumentos derivados.</p>
        </div>
      </div>

      <p style="margin-top:18px;color:var(--muted)">Ofrecemos una amplia gama de instrumentos para diversificar tu cartera.</p>

      <!-- ====== BLOQUE DEPOSIT MOVIDO AQUÍ (debajo de la frase solicitada) ====== -->
      <section class="deposit-section" aria-label="Depositos y Retiros">
        <div class="container">
            <h2 class="deposit-title">Deposita y Retira con Facilidad y Seguridad</h2>

            <div class="deposit-content">
                <div class="info-column left" style="padding-left: 0;">
                    <div class="info-item">
                        <h3 class="item-title">Tarjetas de Crédito/Débito</h3>
                        <p class="item-description">Rápido y seguro, las opciones más populares.</p>
                    </div>
                    <div class="info-item">
                        <h3 class="item-title">Pagos Locales</h3>
                        <p class="item-description">Opciones específicas para cada región.</p>
                    </div>
                </div>

                <div class="circle-chart" id="circleChart">
                    <div class="center-circle"></div>
                    <div class="segment segment-1" data-index="0" data-origin="100% 100%"><i class="fa-solid fa-credit-card"></i></div>
                    <div class="segment segment-2" data-index="1" data-origin="0% 100%"><i class="fa-solid fa-money-bill-transfer"></i></div>
                    <div class="segment segment-3" data-index="2" data-origin="0% 0%"><i class="fa-brands fa-bitcoin"></i></div>
                    <div class="segment segment-4" data-index="3" data-origin="100% 0%"><i class="fa-solid fa-wallet"></i></div>
                    <div class="segment segment-5" data-index="4" data-origin="100% 0%"><i class="fa-solid fa-users"></i></div>
                </div>

                <div class="info-column right" style="padding-right: 0;">
                    <div class="info-item">
                        <h3 class="item-title">Transferencias Bancarias</h3>
                        <p class="item-description">Directo desde tu banco, ideal para montos mayores.</p>
                    </div>
                    <div class="info-item">
                        <h3 class="item-title">Criptomonedas</h3>
                        <p class="item-description">Financia tu cuenta con activos digitales.</p>
                    </div>
                    <div class="info-item">
                        <h3 class="item-title">e-Wallets</h3>
                        <p class="item-description">PayPal, Skrill, Neteller y otros monederos electrónicos.</p>
                    </div>
                </div>
            </div>

            <p class="deposit-footer">Todos los métodos cuentan con tiempos de aprobación transparentes para tu comodidad</p>
        </div>
      </section>
      <!-- ====== FIN BLOQUE DEPOSIT ====== -->

    </div>
  </section>

  <!-- INSTRUMENTOS DETALLE (mantenidos, ahora más ancho) -->
  <section style="padding:36px 0">
    <div class="container">
      <h3>Instrumentos de Trading: Conoce Cada Detalle</h3>

      <div class="card-list" style="margin-top:14px">
        <div class="accent-card">
          <h4>Spreads y Comisiones</h4>
          <p>Transparencia total en nuestros costos para que operes con confianza.</p>
        </div>

        <div class="accent-card">
          <h4>Apalancamiento</h4>
          <p>Amplifica tus operaciones con opciones de apalancamiento flexibles.</p>
        </div>

        <div class="accent-card">
          <h4>Swaps y Márgenes</h4>
          <p>Información clara sobre swaps y requisitos de margen para una gestión eficaz.</p>
        </div>

        <div class="accent-card">
          <h4>Horarios de Mercado</h4>
          <p>Consulta los horarios de trading para cada instrumento y planifica tus estrategias.</p>
        </div>
      </div>

      <div style="margin-top:18px" class="img-slot">
        <img src="/imge.img/3O9hTbpVd0U6NXnh1joLF (1).jpg" alt="Instruments detail" onerror="this.style.display='none'">
      </div>
    </div>
  </section>

  <!-- PLATAFORMAS -->
  <section style="padding:36px 0;background:#0d0d0d">
    <div class="container">
      <h3>Plataformas de Trading Intuitivas y Potentes</h3>
      <p style="color:var(--muted);margin-top:8px">Opera desde cualquier lugar con nuestras plataformas diseñadas para tu éxito.</p>

      <div style="display:flex;gap:18px;flex-wrap:wrap;margin-top:16px">
        <div style="flex:1;min-width:220px" class="card">
          <div style="height:100px;overflow:hidden;border-radius:8px;margin-bottom:12px">
            <img src="/imge.img/Yy7o1e5hqgD_UtiDhBAU0.jpg" alt="WebTrader" onerror="this.style.display='none'">
          </div>
          <h4>WebTrader</h4>
          <p>Acceso instantáneo desde tu navegador sin descargas.</p>
        </div>

        <div style="flex:1;min-width:220px" class="card">
          <div style="height:100px;overflow:hidden;border-radius:8px;margin-bottom:12px">
            <img src="/imge.img/wDJ7kLiUHiwmQUy0WTa3y.jpg" alt="App Móvil" onerror="this.style.display='none'">
          </div>
          <h4>App Móvil</h4>
          <p>Gestiona tus operaciones en movimiento con nuestra app intuitiva.</p>
        </div>

        <div style="flex:1;min-width:220px" class="card">
          <div style="height:100px;overflow:hidden;border-radius:8px;margin-bottom:12px">
            <img src="/imge.img/x5n0qkWTef4rcYY3qNxyu.jpg" alt="MT4/MT5/cTrader" onerror="this.style.display='none'">
          </div>
          <h4>MT4/MT5/cTrader</h4>
          <p>Plataformas líderes para traders avanzados.</p>
        </div>
      </div>

      <div style="margin-top:18px" class="img-slot">
        <img src="/imge.img/suBwzhDGDXvJSbuANOGH_ (1).jpg" alt="Manuales y Tutoriales" onerror="this.style.display='none'">
      </div>
      <p style="margin-top:12px;color:var(--muted)">Manuales y Tutoriales — Guías completas para dominar cada función de la plataforma.</p>
    </div>
  </section>

  <!-- CUENTAS Y PAGOS (mantengo) -->
  <section style="padding:36px 0">
    <div class="container">
      <h3>Elige la Cuenta Perfecta para Ti</h3>
      <p style="color:var(--muted);margin-top:8px">Ofrecemos diferentes tipos de cuentas para adaptarse a tus necesidades y estilo de trading.</p>

      <div class="grid-3" style="margin-top:14px">
        <div class="card"><h4>Cuenta Estándar</h4><p class="muted">Ideal para principiantes y traders con experiencia moderada.</p></div>
        <div class="card"><h4>Cuenta ECN</h4><p class="muted">Para operaciones directas al mercado con spreads muy bajos.</p></div>
        <div class="card"><h4>Cuenta VIP</h4><p class="muted">Beneficios exclusivos y condiciones premium para grandes volúmenes.</p></div>
      </div>

      <h3 style="margin-top:22px">Deposita y Retira con Facilidad y Seguridad</h3>
      <div style="display:flex;gap:18px;flex-wrap:wrap;margin-top:14px">
        <div style="flex:1;min-width:300px" class="card">
          <div class="thumb"><img src="/imge.img/LA1QmiMDzMWegyH1Lxc1J.jpg" alt="Tarjetas" onerror="this.style.display='none'"></div>
          <h4>Tarjetas de Crédito/Débito</h4><p class="muted">Rápido y seguro, las opciones más populares.</p>
        </div>

        <div style="flex:1;min-width:300px" class="card">
          <div class="thumb"><img src="/imge.img/x5n0qkWTef4rcYY3qNxyu.jpg" alt="Transferencias" onerror="this.style.display='none'"></div>
          <h4>Transferencias Bancarias / Criptomonedas / e-Wallets</h4>
          <p class="muted">Directo desde tu banco, criptomonedas, y monederos electrónicos.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- REGULACIÓN, EDUCACIÓN, SOPORTE -->
  <section style="padding:36px 0;background:#0d0d0d">
    <div class="container">
      <h3>Regulación y Seguridad: Nuestra Prioridad</h3>
      <p class="muted">Operamos bajo estrictas regulaciones para garantizar un entorno de trading seguro y transparente.</p>

      <ul style="color:var(--muted);margin-top:12px">
        <li>Número de licencia claramente visible.</li>
        <li>País de regulación y autoridad supervisora.</li>
        <li>Términos y Condiciones, Política de Privacidad, Política de Riesgos y Política de Cookies.</li>
      </ul>

      <h3 style="margin-top:18px">Centro Educativo: Desarrolla Tus Habilidades</h3>
      <p class="muted">Cursos interactivos, webinars en vivo, noticias de mercado y calendario económico.</p>

      <h3 style="margin-top:18px">Soporte Dedicado: Siempre a Tu Lado</h3>
      <p class="muted">Chat en Vivo · WhatsApp <strong>786-872-0660</strong> · Email <strong>contactoleonesbroker@gmail.com</strong></p>

      <div style="margin-top:18px">
        <img src="/imge.img/Yy7o1e5hqgD_UtiDhBAU0.jpg" alt="licence" style="width:100%;max-width:480px;border-radius:12px" onerror="this.style.display='none'">
      </div>
    </div>
  </section>

</main>

<footer id="publicFooter">© Leones Broker — Público</footer>

<!-- Modal -->
<div id="modal" aria-hidden="true">
  <div class="box">
    <h3 id="modalTitle" style="color:var(--gold);margin:0 0 12px">Modal</h3>
    <div id="modalBody"></div>
    <div style="text-align:right;margin-top:12px">
      <button class="btn ghost" id="modalCancel">Cancelar</button>
      <button class="btn" id="modalOk">Aceptar</button>
    </div>
  </div>
</div>

<script>
/* GLOBAL KEYS / HELPERS */
const USERS_KEY = 'leones_images_users';
const SESSION_KEY = 'leones_images_session';

function loadUsers(){ try{ return JSON.parse(localStorage.getItem(USERS_KEY)||'[]'); }catch(e){return[]} }
function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }

function ensureModalHooks(){
  var modal=document.getElementById('modal');
  if(!modal) return;
  var cancel=document.getElementById('modalCancel');
  if(cancel && !cancel.dataset.hooked){ cancel.addEventListener('click', closeModal); cancel.dataset.hooked='1' }
  var ok=document.getElementById('modalOk');
  if(ok && !ok.dataset.hooked){ ok.addEventListener('click', function(){ try{ if(modal._onConfirm) modal._onConfirm(); }catch(e){} closeModal(); }); ok.dataset.hooked='1' }
}
function openModal(html,onConfirm){ ensureModalHooks(); var modal=document.getElementById('modal'); document.getElementById('modalBody').innerHTML=html; modal.style.display='flex'; document.body.style.overflow='hidden'; modal._onConfirm=onConfirm; }
function closeModal(){ var modal=document.getElementById('modal'); if(!modal) return; modal.style.display='none'; document.body.style.overflow=''; modal._onConfirm=null; }

/* PUBLIC: Register / Login (now call showPrivateFull on success) */
document.getElementById('openAccountBtn').addEventListener('click', openRegisterModal);
document.getElementById('loginBtn').addEventListener('click', openLoginModal);

document.getElementById('ctaAbrir').addEventListener('click', ()=> document.getElementById('openAccountBtn').click());
document.getElementById('ctaLogin').addEventListener('click', ()=> document.getElementById('loginBtn').click());

function openRegisterModal(){
  openModal(`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div><label>Nombre</label><input id="r_name" style="width:100%;padding:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:#fff" /></div>
      <div><label>Correo</label><input id="r_email" type="email" style="width:100%;padding:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:#fff" /></div>
      <div><label>Teléfono</label><input id="r_phone" style="width:100%;padding:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:#fff" /></div>
      <div><label>Contraseña</label><input id="r_pass" type="password" style="width:100%;padding:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:#fff" /></div>
    </div>
    <div id="r_msg" style="color:#ff8a8a;margin-top:8px"></div>
  `, function(){
    var name=document.getElementById('r_name').value.trim();
    var email=document.getElementById('r_email').value.trim().toLowerCase();
    var phone=document.getElementById('r_phone').value.trim();
    var pass=document.getElementById('r_pass').value;
    var msg=document.getElementById('r_msg');
    if(!name||!email||!pass){ msg.textContent='Completa los campos'; return; }
    var users=loadUsers();
    if(users.find(u=>u.email===email)){ msg.textContent='Correo ya registrado'; return; }
    var user={name,email,phone,pass,created:Date.now()};
    users.push(user); saveUsers(users);
    // Persist session and open full private area
    localStorage.setItem(SESSION_KEY, JSON.stringify(user));
    closeModal();
    if(typeof showPrivateFull === 'function'){ showPrivateFull(user); } else { enterPrivateMode(user); }
  });
}

function openLoginModal(){
  openModal(`
    <div><label>Correo</label><input id="l_email" type="email" style="width:100%;padding:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:#fff" /></div>
    <div><label>Contraseña</label><input id="l_pass" type="password" style="width:100%;padding:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:#fff" /></div>
    <div id="l_msg" style="color:#ff8a8a;margin-top:8px"></div>
  `, function(){
    var email=document.getElementById('l_email').value.trim().toLowerCase();
    var pass=document.getElementById('l_pass').value;
    var users=loadUsers();
    var user=users.find(u=>u.email===email && u.pass===pass);
    if(!user){ document.getElementById('l_msg').textContent='Credenciales inválidas'; return; }
    localStorage.setItem(SESSION_KEY, JSON.stringify(user));
    closeModal();
    if(typeof showPrivateFull === 'function'){ showPrivateFull(user); } else { enterPrivateMode(user); }
  });
}

/* PUBLIC helper to restore header actions after logout */
function restorePublicHeader(){
  const headerActions = document.getElementById('headerActions');
  headerActions.innerHTML = '';
  const openBtn = document.createElement('button'); openBtn.className = 'btn glow'; openBtn.id = 'openAccountBtn'; openBtn.textContent = 'Abrir Cuenta';
  const loginBtn = document.createElement('button'); loginBtn.className = 'btn ghost glow'; loginBtn.id = 'loginBtn'; loginBtn.textContent = 'Iniciar Sesión';
  headerActions.appendChild(openBtn); headerActions.appendChild(loginBtn);
  // reattach
  openBtn.addEventListener('click', openRegisterModal);
  loginBtn.addEventListener('click', openLoginModal);
  // CTAs already bound in initial load, but ensure they call open buttons
  document.getElementById('ctaAbrir').addEventListener('click', ()=> openBtn.click());
  document.getElementById('ctaLogin').addEventListener('click', ()=> loginBtn.click());
}

/* -------------------------
   PARTE PRIVADA COMPLETA
   ------------------------- */
/* Estilos y contenedor ya insertados más abajo (sección marcada PARTE PRIVADA) */
/* showPrivateFull / performLogoutFull implementan la navegación automática desde login/register */

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }

/* showPrivateFull: muestra la PARTE PRIVADA COMPLETA (usa el DOM de la sección privada) */
function showPrivateFull(user){
  try{
    // hide public
    document.getElementById('publicMain').style.display='none';
    document.getElementById('publicFooter').style.display='none';
    // update header: show user + logout
    const headerActions = document.getElementById('headerActions');
    headerActions.innerHTML = '';
    const profileBtn = document.createElement('div');
    profileBtn.style.display = 'flex'; profileBtn.style.alignItems = 'center'; profileBtn.style.gap = '10px';
    const nameEl = document.createElement('div'); nameEl.textContent = user.name || 'Usuario'; nameEl.style.color = 'var(--gold)'; nameEl.style.fontWeight='700';
    const logoutBtn = document.createElement('button'); logoutBtn.className = 'btn ghost'; logoutBtn.textContent = 'Cerrar sesión';
    logoutBtn.addEventListener('click', performLogoutFull);
    profileBtn.appendChild(nameEl); profileBtn.appendChild(logoutBtn);
    headerActions.appendChild(profileBtn);

    // show private container (the block inserted below)
    const privateWrapper = document.getElementById('privateArea_full');
    if(privateWrapper) {
      privateWrapper.style.display = 'flex';
      // set info inside private area
      const nameSpan = document.getElementById('private-name-full'); if(nameSpan) nameSpan.textContent = user.name || 'Usuario';
      const emailSpan = document.getElementById('private-email-full'); if(emailSpan) emailSpan.textContent = user.email || '';
      const bal = document.getElementById('priv_balance_full'); if(bal) bal.textContent = 'RD$'+(Math.floor(Math.random()*50000)+1000).toLocaleString('es-DO');
      const eq = document.getElementById('priv_equity_full'); if(eq) eq.textContent = 'RD$'+(Math.floor(Math.random()*40000)+500).toLocaleString('es-DO');
      const pnl = document.getElementById('priv_pnl_full'); if(pnl) pnl.textContent = 'RD$'+(Math.floor(Math.random()*20000)-5000).toLocaleString('es-DO');

      // menu behaviors (activate dashboard by default)
      const menuItems = Array.from(document.querySelectorAll('#privateArea_full .menu-item'));
      function activateSection(sectionId){
        menuItems.forEach(mi=>mi.classList.toggle('active', mi.dataset.section===sectionId));
        // sections inside privateArea_full are minimal (dashboard only), expand later if needed
      }
      menuItems.forEach(mi=>mi.addEventListener('click', ()=> activateSection(mi.dataset.section)));
      activateSection('dashboard');

      // logout handlers inside private area
      const leftLogout = document.getElementById('btnLogoutLeft_full'); if(leftLogout) leftLogout.onclick = performLogoutFull;
      const topLogout = document.getElementById('logoutTop_full'); if(topLogout) topLogout.onclick = performLogoutFull;
    }

    // persist session
    localStorage.setItem(SESSION_KEY, JSON.stringify(user));
    // scroll to top
    window.scrollTo({top:0,behavior:'smooth'});
  }catch(e){
    console.error('showPrivateFull error', e);
  }
}

function performLogoutFull(){
  try{
    localStorage.removeItem(SESSION_KEY);
    // hide private
    const privateWrapper = document.getElementById('privateArea_full');
    if(privateWrapper) privateWrapper.style.display = 'none';
    // restore public UI + header actions
    document.getElementById('publicMain').style.display = '';
    document.getElementById('publicFooter').style.display = '';
    restorePublicHeader();
    // reattach CTAs (they exist already, but ensure handlers present)
    document.getElementById('ctaAbrir').addEventListener('click', ()=> document.getElementById('openAccountBtn').click());
    document.getElementById('ctaLogin').addEventListener('click', ()=> document.getElementById('loginBtn').click());
  }catch(e){ console.error('logout error', e); }
}

/* On load: fix image paths, restore session and init deposit chart */
window.addEventListener('load', function(){
  ensureModalHooks();
  // fix filenames with spaces/parens
  Array.from(document.images).forEach(img=>{
    try{
      let s = img.getAttribute('src')||'';
      if(s && !s.match(/^https?:\/\//i) && /[ \(\)]/.test(s)){
        let fixed = s.replace(/ /g, '%20').replace(/\(/g, '%28').replace(/\)/g, '%29');
        img.setAttribute('src', fixed);
      }
    }catch(e){}
  });

  // restore session
  var s = localStorage.getItem(SESSION_KEY);
  if(s){ try{ var u = JSON.parse(s); if(typeof showPrivateFull === 'function'){ showPrivateFull(u); } }catch(e){} }

  // rotate circle-chart icons
  try{
    const segments = document.querySelectorAll('.segment');
    const totalSegments = segments.length;
    const degreesPerSegment = 360 / totalSegments;
    segments.forEach((segment, index) => {
        const rotation = index * degreesPerSegment;
        const origin = segment.dataset.origin || '50% 50%';
        segment.style.transformOrigin = origin;
        segment.style.transform = `rotate(${rotation}deg)`;
        const icon = segment.querySelector('i');
        if (icon) {
            icon.style.transform = `rotate(-${rotation}deg)`;
            icon.style.position = 'absolute';
            let top, right, bottom, left;
            const offset = '30%';
            switch (index) {
                case 0: top = offset; left = offset; break;
                case 1: top = offset; right = offset; break;
                case 2: bottom = offset; right = offset; break;
                case 3: bottom = offset; right = offset; break;
                case 4: bottom = offset; left = offset; break;
            }
            icon.style.top = top || '';
            icon.style.right = right || '';
            icon.style.bottom = bottom || '';
            icon.style.left = left || '';
        }
    });
  }catch(e){}
});
</script>

<!-- ================= PARTE PRIVADA COMPLETA ================= -->
<!-- Debajo está la parte privada (HTML + CSS + JS) tal y como la solicitaste, CON MEJORAS. -->

<!-- ESTILOS EXCLUSIVOS (PARTE PRIVADA) -->
<style>
  :root{
    --bg:#070707; --surface:#0f0f0f; --muted:#9aa0a6; --text:#e9e6e0;
    --gold:#d4af37; --danger:#cf304a; --line:rgba(255,255,255,0.06);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;
    background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
    line-height:1.35; font-size:14px; overflow:auto;
  }

  /* prevent background scroll when sidebar open on mobile */
  .no-scroll-sidebar { height:100vh; overflow:hidden; }

  /* Header */
  .header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:linear-gradient(90deg,#0b0b0b,#111);border-bottom:1px solid var(--line);position:fixed;top:0;left:0;right:0;z-index:100;height:64px}
  .header-left{display:flex;align-items:center;gap:12px}
  .menu-toggle{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--gold);cursor:pointer;display:flex;align-items:center;justify-content:center}
  .logo{font-weight:800;color:var(--gold);font-size:18px;letter-spacing:0.6px}
  .user{display:flex;gap:12px;align-items:center;color:var(--muted)}
  .avatar{width:40px;height:40px;border-radius:8px;background:#111;display:flex;align-items:center;justify-content:center;color:var(--gold);font-weight:700}

  /* Layout */
  .main-wrap{padding-top:80px;max-width:none; width: auto; margin:0 2%;}
  .layout{display:grid;grid-template-columns:260px 1fr; gap:18px;padding:18px 12px 120px;min-height:calc(100vh - 120px)}
  .sidebar{background:linear-gradient(180deg,#0c0c0c,#0b0b0b);border-radius:12px;padding:12px;border:1px solid var(--line);overflow:auto;transition:transform .22s ease;max-height: calc(100vh - 140px)}
  .sidebar.hidden{transform:translateX(-110%)}
  .menu-item{padding:12px 14px;border-radius:8px;color:var(--muted);display:flex;align-items:center;gap:10px;cursor:pointer;margin-bottom:8px;font-weight:700;font-size:14px}
  .menu-item.active{background:linear-gradient(90deg, rgba(212,175,55,0.08), rgba(201,161,46,0.03));color:var(--gold);box-shadow: inset 0 0 0 1px rgba(212,175,55,0.04);}

  .panel{background:linear-gradient(180deg,#0b0b0b,#0c0c0c);border-radius:12px;padding:18px;border:1px solid var(--line);height:100%;overflow:auto;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
  .title{font-size:20px;color:var(--text);margin-bottom:12px;font-weight:800}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:14px}
  .card{background:linear-gradient(180deg,#0f0f0f,#0d0d0d);border-radius:10px;padding:14px;border:1px solid rgba(212,175,55,0.06)}
  .card .value{font-weight:800;color:var(--gold);font-size:18px}
  .muted{color:var(--muted);font-size:13px}

  .table-box{background:linear-gradient(180deg,#0f0f0f,#0d0d0d);border-radius:10px;padding:12px;border:1px solid var(--line);overflow:auto}
  table{width:100%;border-collapse:collapse;color:var(--text);font-size:13px}
  th{text-align:left;padding:10px;font-weight:700;color:var(--muted);border-bottom:1px solid var(--line)}
  td{padding:10px;border-bottom:1px dashed rgba(255,255,255,0.02)}
  tr.clickable{cursor:pointer}
  tr.clickable:hover{background:rgba(212,175,55,0.02)}

  /* Symbols list */
  .symbols-top{display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
  .cat-tabs{display:flex;gap:8px;flex-wrap:wrap}
  .cat-tab{padding:6px 10px;border-radius:8px;border:1px solid var(--line);background:transparent;color:var(--muted);cursor:pointer;font-weight:700}
  .cat-tab.active{background:rgba(212,175,55,0.06);color:var(--gold)}
  .search-input{flex:1;min-width:200px;padding:8px;border-radius:8px;border:1px solid var(--line);background:#0b0b0b;color:var(--text)}
  .symbols-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px; margin-top:10px}
  .symbol-card{padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg,#0f0f0f,#0d0d0d);cursor:pointer}
  .symbol-card:hover{box-shadow:0 8px 20px rgba(0,0,0,0.5);border-color:rgba(212,175,55,0.08)}

  /* Trading specifics */
  #tv_chart_container {width:100%;height:420px;border-radius:8px;overflow:hidden;background:#000;border:1px solid rgba(255,255,255,0.03)}
  .order-book-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  .ob-col{background:transparent;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
  .ob-row{display:flex;justify-content:space-between;padding:6px 0;font-size:13px;color:var(--muted)}

  .trade-panel{display:grid;grid-template-columns:1fr 320px;gap:12px;margin-top:12px}
  .trade-box{background:#0b0b0b;border-radius:8px;border:1px solid var(--line);padding:12px}
  .form-row{display:flex;gap:8px;margin-bottom:8px}
  .form-input,.form-select{background:#0b0b0b;border:1px solid var(--line);color:var(--text);padding:8px;border-radius:6px;width:100%}

  .btn-primary{background:var(--gold);color:#07100a;border:none;padding:10px 14px;border-radius:8px;font-weight:800;cursor:pointer;box-shadow:0 6px 20px rgba(201,161,46,0.12)}
  .btn-secondary{background:transparent;color:var(--gold);border:1px solid rgba(212,175,55,0.18);padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}

  .positions-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .pos-card{background:linear-gradient(180deg,#0f0f0f,#0d0d0d);padding:10px;border-radius:8px;border:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;cursor:pointer}
  .pos-card:hover{box-shadow:0 8px 20px rgba(0,0,0,0.4)}

  /* Footer nav */
  .footer-nav{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(90deg,#0b0b0b,#0c0c0c);border-top:1px solid var(--line);display:flex;justify-content:space-around;padding:10px 0;z-index:60}
  .fnav-item{color:var(--muted);font-size:12px;text-align:center;cursor:pointer}
  .fnav-item.active{color:var(--gold);font-weight:800}
  .fnav-item i{display:block;font-size:18px;margin-bottom:4px}

  /* sidebar overlay (mobile) */
  #sidebarOverlay{display:none;position:fixed;left:0;top:64px;right:0;bottom:0;background:rgba(0,0,0,0.45);z-index:90;transition:opacity .2s ease}

  @media(max-width:1000px){
    .layout{grid-template-columns:1fr;padding:88px 12px 140px;min-height:auto}
    #tv_chart_container{height:300px}
    .trade-panel{grid-template-columns:1fr}
    .sidebar{position:fixed;left:0;top:64px;bottom:0;width:220px;z-index:95;transform:translateX(-110%)}
    .sidebar:not(.hidden){transform:translateX(0)}
    /* ensure overlay visible when sidebar open */
    #sidebarOverlay{display:none}
  }

  .muted-small{color:var(--muted);font-size:12px}
  .kbd {background:#0b0b0b;border:1px solid var(--line);padding:4px 6px;border-radius:6px;font-weight:700;color:var(--muted);font-size:12px}
</style>

<!-- MARCA: PARTE PRIVADA (HTML) -->
<div id="privateArea_full" style="display:none;">
  <!-- overlay for mobile sidebar -->
  <div id="sidebarOverlay" aria-hidden="true"></div>

  <!-- BEGIN: contenido importado de la parte privada (BrokerPro) -->
  <header class="header">
    <div class="header-left">
      <button class="menu-toggle" id="menuToggle" title="Abrir/Cerrar menú" aria-label="Abrir o cerrar menú">☰</button>
      <div class="logo">BrokerPro <span style="font-weight:500;color:var(--muted);font-size:12px;margin-left:8px">— Profesional</span></div>
    </div>

    <div class="user" id="headerUserArea">
      <div style="text-align:right">
        <div style="font-weight:800;color:var(--gold)" id="privateHeaderName">Usuario</div>
        <div style="font-size:12px;color:var(--muted)">Bienvenido</div>
      </div>
      <div class="avatar" id="headerAvatar">P</div>
      <button class="btn-primary" id="headerLogoutBtn" style="padding:8px 10px;margin-left:8px">Salir</button>
    </div>
  </header>

  <div class="main-wrap">
    <div class="layout">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar" role="navigation" aria-label="Menu lateral">
        <div class="menu-item active" data-target="dashboard" onclick="navSidebar(event)"><i class="fa-solid fa-house"></i> Overview</div>
        <div class="menu-item" data-target="trading" onclick="navSidebar(event)"><i class="fa-solid fa-chart-line"></i> Trading</div>
        <div class="menu-item" data-target="history" onclick="navSidebar(event)"><i class="fa-solid fa-clock-rotate-left"></i> Historial de transacciones</div>
        <div class="menu-item" data-target="verification" onclick="navSidebar(event)"><i class="fa-solid fa-id-card"></i> Verificación de documentos</div>
        <div class="menu-item" data-target="deposit" onclick="navSidebar(event)"><i class="fa-solid fa-arrow-down"></i> Depósito</div>
        <div class="menu-item" data-target="withdraw" onclick="navSidebar(event)"><i class="fa-solid fa-arrow-up"></i> Retiro</div>

        <div style="height:8px"></div>
        <div style="border-top:1px solid var(--line);margin-top:12px;padding-top:12px;color:var(--muted);font-size:13px">Accesos rápidos</div>
        <div class="menu-item" onclick="showModalInfo()"><i class="fa-solid fa-circle-info"></i> Info</div>
      </aside>

      <!-- Panels -->
      <section class="panel" id="dashboardPanel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div>
            <div class="title">Bienvenido, <span style="color:var(--gold)" id="privateWelcomeName">Pedro</span></div>
            <div class="muted">Resumen rápido de tu cuenta — abajo verás el listado completo de símbolos</div>
          </div>
          <div style="text-align:right">
            <div class="muted">Saldo disponible</div>
            <div style="font-weight:900;color:var(--gold);font-size:20px">$<span id="bal-usdt-top">0.00</span></div>
          </div>
        </div>

        <div class="cards">
          <div class="card"><div class="muted">Balance Total</div><div class="value" id="balanceTotal">$0.00</div><div class="muted" style="margin-top:6px">Estado por el backend</div></div>
          <div class="card"><div class="muted">Inversiones Activas</div><div class="value" id="investTotal">$0.00</div><div class="muted" style="margin-top:6px">Posiciones: <strong id="pos-count">0</strong></div></div>
          <div class="card"><div class="muted">Efectivo Disponible</div><div class="value" id="cashAvail">$0.00</div><div class="muted" style="margin-top:6px">Listo para operar</div></div>
          <div class="card"><div class="muted">Ganancia / Pérdida</div><div class="value" id="pnlTotal">$0.00</div><div class="muted" style="margin-top:6px">Este periodo</div></div>
        </div>

        <!-- SYMBOL SEARCH + CATEGORIES -->
        <div>
          <div class="symbols-top">
            <div class="cat-tabs" id="catTabs"></div>
            <input id="symbolSearch" class="search-input" placeholder="Buscar símbolo, ej: BTC, ETH, EURUSD, AAPL..." />
          </div>
          <div id="symbolsGrid" class="symbols-grid"></div>
        </div>
      </section>

      <section class="panel" id="tradingPanel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div>
            <div class="title" id="trading-title">Trading — <span id="tradingSymbol">—</span></div>
            <div class="muted" id="trading-sub">Market: —</div>
          </div>
          <div class="muted">Estado: <span id="ws-status">real</span></div>
        </div>

        <div class="market-list" id="market-list"></div>

        <div style="display:flex;gap:12px;flex-direction:column">
          <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
            <div style="flex:1; min-width:320px; position:relative">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div id="op-symbol" style="font-weight:900;color:var(--gold);font-size:22px">—</div>
                  <div class="muted" id="op-exchange">Market: —</div>
                </div>
                <div style="text-align:right">
                  <div id="op-price" style="font-weight:900;color:var(--gold);font-size:22px">—</div>
                  <div class="muted-small">Último</div>
                </div>
              </div>

              <!-- chart: se carga solo aquí -->
              <div id="tv_chart_container" style="margin-top:12px">El gráfico se cargará cuando haya un símbolo real y la librería TradingView esté disponible.</div>

              <div class="order-book-grid">
                <div class="ob-col">
                  <div style="font-weight:800;color:var(--gold);margin-bottom:8px">BIDS</div>
                  <div id="ob-bids" class="muted"></div>
                </div>
                <div class="ob-col">
                  <div style="font-weight:800;color:var(--gold);margin-bottom:8px">ASKS</div>
                  <div id="ob-asks" class="muted"></div>
                </div>
              </div>
            </div>

            <!-- TRADE BOX -->
            <aside style="width:320px">
              <div class="trade-box">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                  <div style="font-weight:800;color:var(--gold)">Crear Orden</div>
                  <div class="muted-small">Saldo: $<span id="bal-usdt">0.00</span></div>
                </div>

                <div style="margin-bottom:8px">
                  <label class="muted-small">Tipo</label>
                  <select id="order-type" class="form-select">
                    <option>Market</option>
                    <option>Limit</option>
                    <option>Stop Loss</option>
                    <option>Take Profit</option>
                    <option>Stop Limit</option>
                  </select>
                </div>

                <div class="form-row">
                  <div style="flex:1">
                    <label class="muted-small">Cantidad (ej. BTC)</label>
                    <input id="order-qty" class="form-input" type="number" step="0.000001" placeholder="0.01">
                  </div>
                </div>

                <div class="form-row">
                  <div style="flex:1">
                    <label class="muted-small">Precio (si aplica)</label>
                    <input id="order-price" class="form-input" type="number" step="0.01" placeholder="0.00">
                  </div>
                </div>

                <div style="display:flex;gap:8px;margin-top:8px">
                  <button class="btn-primary" id="btnBuy">Buy</button>
                  <button class="btn-secondary" id="btnSell">Sell</button>
                </div>

                <div class="orders-box" id="orders-box" style="margin-top:12px">
                  <div style="font-weight:800;color:var(--gold);margin-bottom:8px">Órdenes Pendientes</div>
                  <div id="orders-list" class="muted-small">— no hay órdenes —</div>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </section>

      <section class="panel" id="positionsPanel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div>
            <div class="title">Posiciones Abiertas</div>
            <div class="muted">Clic en una posición para abrirla en Trading con su gráfico</div>
          </div>
          <div class="muted">Total: <span id="pos-count-top">0</span></div>
        </div>

        <div id="positionsList" class="positions-list"></div>
      </section>

      <section class="panel" id="marketsPanel" style="display:none">
        <div class="title">Mercados</div>
        <div class="muted" style="margin-bottom:8px">Selecciona un mercado desde la lista — todo el mercado disponible</div>

        <div class="symbols-top" style="margin-top:8px">
          <div id="catTabsMarket" class="cat-tabs"></div>
          <input id="marketSearch" class="search-input" placeholder="Buscar símbolo o mercado..." />
        </div>

        <div id="marketsSymbolsGrid" class="symbols-grid"></div>
      </section>

      <section class="panel" id="activosPanel" style="display:none">
        <div class="title">Activos</div>
        <div class="table-box">
          <div style="font-weight:800;color:var(--gold);margin-bottom:8px">Billetera</div>
          <table>
            <thead><tr><th>Activo</th><th>Cantidad</th><th>Valor Estimado</th></tr></thead>
            <tbody id="walletRows"></tbody>
          </table>
        </div>
      </section>

      <section class="panel" id="historyPanel" style="display:none">
        <div class="title">Historial de Transacciones</div>
        <div class="table-box">
          <table><thead><tr><th>ID</th><th>Fecha</th><th>Tipo</th><th>Método</th><th>Monto</th><th>Estado</th></tr></thead>
          <tbody>
            <tr><td>#TRX-8821</td><td>2025-12-10</td><td>Depósito</td><td>Transferencia</td><td class="muted-small">+$5,000.00</td><td><span class="kbd">Completado</span></td></tr>
          </tbody></table>
        </div>
      </section>

      <section class="panel" id="verificationPanel" style="display:none">
        <div class="title">Verificación de Documentos</div>
        <div class="muted">Sube tus documentos aquí</div>
        <div style="margin-top:12px" class="table-box">
          <form onsubmit="submitDoc(event)">
            <label class="muted-small">Tipo</label>
            <select class="form-select" style="margin-bottom:8px"><option>Identificación</option><option>Comprobante de domicilio</option></select>
            <input type="file" required class="form-input" style="margin-bottom:8px">
            <button class="btn-primary" type="submit">Subir</button>
          </form>
        </div>
      </section>

      <section class="panel" id="depositPanel" style="display:none">
        <div class="title">Depósito</div>
        <div class="muted">Opciones: Transferencia bancaria / Crypto</div>
        <div style="margin-top:12px" class="table-box">
          <form onsubmit="submitTransaction(event)">
            <label class="muted-small">Monto</label>
            <input class="form-input" type="number" step="0.01" required>
            <label class="muted-small">Método</label>
            <select class="form-select" style="margin-bottom:8px"><option>Transferencia</option><option>Crypto</option></select>
            <button class="btn-primary" type="submit">Enviar</button>
          </form>
        </div>
      </section>

      <section class="panel" id="withdrawPanel" style="display:none">
        <div class="title">Retiro</div>
        <div class="muted">Solicita un retiro a tu cuenta registrada</div>
        <div style="margin-top:12px" class="table-box">
          <form onsubmit="submitTransaction(event)">
            <label class="muted-small">Monto</label>
            <input class="form-input" type="number" step="0.01" required>
            <label class="muted-small">Cuenta destino</label>
            <input class="form-input" type="text" required>
            <button class="btn-primary" type="submit">Solicitar</button>
          </form>
        </div>
      </section>

    </div>
  </div>

  <!-- Footer nav -->
  <nav class="footer-nav">
    <div class="fnav-item active" data-target="dashboardPanel" onclick="footerNavClick(event)"><i class="fa-solid fa-house"></i>Inicio</div>
    <div class="fnav-item" data-target="tradingPanel" onclick="footerNavClick(event)"><i class="fa-solid fa-chart-line"></i>Trading</div>
    <div class="fnav-item" data-target="positionsPanel" onclick="footerNavClick(event)"><i class="fa-solid fa-layer-group"></i>Posiciones</div>
    <div class="fnav-item" data-target="marketsPanel" onclick="footerNavClick(event)"><i class="fa-solid fa-chart-simple"></i>Mercados</div>
    <div class="fnav-item" data-target="activosPanel" onclick="footerNavClick(event)"><i class="fa-solid fa-wallet"></i>Activos</div>
  </nav>

  <!-- Info modal -->
  <div id="infoModal" style="display:none;position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:120">
    <div style="background:#0b0b0b;padding:18px;border-radius:10px;border:1px solid var(--line);width:90%;max-width:520px;color:var(--text)">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <strong style="color:var(--gold)">BrokerPro — Info</strong>
        <button onclick="hideModalInfo()" style="background:transparent;border:none;color:var(--muted);font-size:22px;cursor:pointer">&times;</button>
      </div>
      <div style="color:var(--muted)">Para operar con capital real se requiere integración de APIs en back-end. Los datos mostrados aquí dependen del servidor administrativo.</div>
    </div>
  </div>

  <!-- Scripts (importados de la parte privada) -->
  <script>
  /* ---------------------------
     Datos de símbolos — lista amplia de ejemplo (estática)
     --------------------------- */
  const ALL_SYMBOLS = [
    {symbol:'BINANCE:BTCUSDT', label:'BTC/USDT', market:'Crypto'},
    {symbol:'BINANCE:ETHUSDT', label:'ETH/USDT', market:'Crypto'},
    {symbol:'BINANCE:SOLUSDT', label:'SOL/USDT', market:'Crypto'},
    {symbol:'BINANCE:XRPUSDT', label:'XRP/USDT', market:'Crypto'},
    {symbol:'BINANCE:ADAUSDT', label:'ADA/USDT', market:'Crypto'},
    {symbol:'NASDAQ:AAPL', label:'AAPL', market:'Stocks'},
    {symbol:'NASDAQ:MSFT', label:'MSFT', market:'Stocks'},
    {symbol:'NASDAQ:TSLA', label:'TSLA', market:'Stocks'},
    {symbol:'NASDAQ:GOOGL', label:'GOOGL', market:'Stocks'},
    {symbol:'NYSE:BRK.B', label:'BRK.B', market:'Stocks'},
    {symbol:'OANDA:EUR_USD', label:'EUR/USD', market:'Forex'},
    {symbol:'OANDA:GBP_USD', label:'GBP/USD', market:'Forex'},
    {symbol:'OANDA:USD_JPY', label:'USD/JPY', market:'Forex'},
    {symbol:'OANDA:AUD_USD', label:'AUD/USD', market:'Forex'},
    {symbol:'INDEX:SPX', label:'S&P 500', market:'Indices'},
    {symbol:'INDEX:NDAQ', label:'NASDAQ 100', market:'Indices'},
    {symbol:'INDEX:DJI', label:'Dow Jones', market:'Indices'},
    {symbol:'CME:ES1!', label:'ES (S&P Futures)', market:'Futures'},
    {symbol:'CME:CL1!', label:'Crude Oil Futures', market:'Futures'},
    {symbol:'US10Y', label:'US 10Y Bond', market:'Bonds'},
    {symbol:'ECONOMY:US', label:'US Economic Calendar', market:'Economy'},
    {symbol:'OPTIONS:AAPL', label:'AAPL Options', market:'Options'},
    {symbol:'BINANCE:MNTUSDT', label:'MNT/USDT', market:'Crypto'},
    {symbol:'INDEX:RUS', label:'Russell 2000', market:'Indices'},
    {symbol:'FOREX:CHF_USD', label:'CHF/USD', market:'Forex'},
    {symbol:'NASDAQ:AMZN', label:'AMZN', market:'Stocks'},
    {symbol:'NYSE:WMT', label:'WMT', market:'Stocks'}
  ];

  /* symbolPrices puede ser poblado por backend vía fetch; aquí hay valores estáticos como placeholder */
  const symbolPrices = {
    'BINANCE:BTCUSDT': 87243.3,
    'BINANCE:ETHUSDT': 2925.8,
    'BINANCE:SOLUSDT': 127.7,
    'OANDA:EUR_USD': 1.0850,
    'OANDA:GBP_USD': 1.2500,
    'INDEX:SPX': 5200,
    'NASDAQ:AAPL': 182.5,
    'NASDAQ:TSLA': 238.9
  };

  /* IMPORTANT: no más motor "demo" que modifica precios.
     El backend o websockets deben proveer precios reales. */
  let demo_usdt = 0.00; // balance por defecto 0 (el admin/ backend debe actualizar)
  let demo_balances = {}; // sin balances locales por defecto
  let pendingOrders = [];
  let positions = []; // se pueden poblar desde backend

  /* DOM refs */
  const menuToggle = document.getElementById('menuToggle');
  const symbolSearch = document.getElementById('symbolSearch');
  const symbolsGrid = document.getElementById('symbolsGrid');
  const catTabs = document.getElementById('catTabs');
  const marketsSymbolsGrid = document.getElementById('marketsSymbolsGrid');
  const marketSearch = document.getElementById('marketSearch');
  const catTabsMarket = document.getElementById('catTabsMarket');

  const opSymbolEl = document.getElementById('op-symbol');
  const opExchangeEl = document.getElementById('op-exchange');
  const opPriceEl = document.getElementById('op-price');
  const obBidsEl = document.getElementById('ob-bids');
  const obAsksEl = document.getElementById('ob-asks');
  const ordersListEl = document.getElementById('orders-list');
  const balUsdtEl = document.getElementById('bal-usdt');
  const balUsdtTop = document.getElementById('bal-usdt-top');
  const balanceTotalEl = document.getElementById('balanceTotal');
  const posCountEl = document.getElementById('pos-count');
  const posCountTop = document.getElementById('pos-count-top');
  const sidebarOverlay = document.getElementById('sidebarOverlay');

  /* UI: menu toggle (already wired in showPrivateFull too) - ensure handlers exist */
  if(menuToggle){
    menuToggle.addEventListener('click', ()=> {
      const sidebar = document.getElementById('sidebar');
      if(!sidebar) return;
      sidebar.classList.toggle('hidden');
      if(sidebar.classList.contains('hidden')){
        if(sidebarOverlay) sidebarOverlay.style.display = 'none';
        document.body.classList.remove('no-scroll-sidebar');
      } else {
        if(sidebarOverlay) sidebarOverlay.style.display = 'block';
        document.body.classList.add('no-scroll-sidebar');
      }
    });
  }
  if(sidebarOverlay){
    sidebarOverlay.addEventListener('click', ()=> {
      const sidebar = document.getElementById('sidebar');
      if(sidebar) sidebar.classList.add('hidden');
      sidebarOverlay.style.display = 'none';
      document.body.classList.remove('no-scroll-sidebar');
    });
  }

  /* NAV helpers */
  function hideAllPanels(){
    document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
    document.querySelectorAll('.fnav-item').forEach(f => f.classList.remove('active'));
  }
  function showPanel(id){
    hideAllPanels();
    const panel = document.getElementById(id);
    if(panel) panel.style.display = 'block';
    document.querySelectorAll('.fnav-item').forEach(f=>{
      if(f.dataset.target === id) f.classList.add('active');
    });
    // close sidebar overlay on mobile when navigating
    const sidebar = document.getElementById('sidebar');
    if(sidebar && !sidebar.classList.contains('hidden') && window.innerWidth <= 1000){
      sidebar.classList.add('hidden');
      if(sidebarOverlay) sidebarOverlay.style.display = 'none';
      document.body.classList.remove('no-scroll-sidebar');
    }
  }

  function footerNavClick(e){
    const btn = e.currentTarget;
    const target = btn.dataset.target;
    showPanel(target);
    if(target === 'tradingPanel') initTradingIfNeeded();
  }

  function navSidebar(evt){
    const el = evt.currentTarget;
    const target = el.dataset.target;
    const mapping = {
      'dashboard':'dashboardPanel','trading':'tradingPanel',
      'history':'historyPanel','verification':'verificationPanel',
      'deposit':'depositPanel','withdraw':'withdrawPanel'
    };
    const panelId = mapping[target] || 'dashboardPanel';
    showPanel(panelId);
    document.querySelectorAll('#privateArea_full .menu-item').forEach(item => item.classList.remove('active'));
    el.classList.add('active');
    if(panelId === 'tradingPanel') initTradingIfNeeded();
    // close sidebar on mobile after click
    const sidebar = document.getElementById('sidebar');
    if(sidebar && window.innerWidth <= 1000){
      sidebar.classList.add('hidden');
      if(sidebarOverlay) sidebarOverlay.style.display = 'none';
      document.body.classList.remove('no-scroll-sidebar');
    }
  }

  function showModalInfo(){ document.getElementById('infoModal').style.display = 'flex'; }
  function hideModalInfo(){ document.getElementById('infoModal').style.display = 'none'; }

  /* SYMBOLS UI */
  const CATEGORIES = ['All','Stocks','Crypto','Forex','Indices','Futures','Bonds','Economy','Options'];
  let activeCategory = 'All';

  function buildCategoryTabs(container, onClick){
    if(!container) return;
    container.innerHTML = '';
    CATEGORIES.forEach(cat=>{
      const b = document.createElement('button');
      b.className = 'cat-tab' + (cat===activeCategory ? ' active':'');
      b.innerText = cat;
      b.onclick = ()=> { activeCategory = cat; document.querySelectorAll('.cat-tab').forEach(x=>x.classList.remove('active')); b.classList.add('active'); onClick(); };
      container.appendChild(b);
    });
  }

  function filterSymbols(q, category){
    q = (q||'').trim().toLowerCase();
    return ALL_SYMBOLS.filter(s=>{
      if(category && category !== 'All' && s.market !== category) return false;
      if(!q) return true;
      return (s.label.toLowerCase().includes(q) || s.symbol.toLowerCase().includes(q));
    });
  }

  function renderSymbolsGrid(container, query, category){
    if(!container) return;
    container.innerHTML = '';
    const list = filterSymbols(query, category);
    if(list.length === 0){
      container.innerHTML = '<div style="color:var(--muted)">— no se encontraron símbolos —</div>';
      return;
    }
    list.forEach(s=>{
      const el = document.createElement('div');
      el.className = 'symbol-card';
      el.onclick = ()=> { selectSymbolAndOpenTrading(s.symbol, s.label); };
      el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800;color:var(--gold)">${s.label}</div>
          <div style="color:var(--muted);font-size:12px;margin-top:6px">${s.market} · ${s.symbol}</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:800;color:var(--text);font-size:14px">${displayPriceFor(s.symbol)}</div>
          <div style="color:var(--muted);font-size:12px;margin-top:6px">Últ</div>
        </div>
      </div>`;
      container.appendChild(el);
    });
  }

  function displayPriceFor(sym){
    const p = symbolPrices[sym];
    if(!isFinite(p)) return '--';
    return (Math.abs(p) > 1000) ? p.toLocaleString(undefined,{maximumFractionDigits:1}) : p.toFixed(6);
  }

  buildCategoryTabs(catTabs, ()=> renderSymbolsGrid(symbolsGrid, symbolSearch ? symbolSearch.value : '', activeCategory));
  buildCategoryTabs(catTabsMarket, ()=> renderSymbolsGrid(marketsSymbolsGrid, marketSearch ? marketSearch.value : '', activeCategory));
  renderSymbolsGrid(symbolsGrid, '', 'All');
  renderSymbolsGrid(marketsSymbolsGrid, '', 'All');

  if(symbolSearch) symbolSearch.addEventListener('input', ()=> renderSymbolsGrid(symbolsGrid, symbolSearch.value, activeCategory));
  if(marketSearch) marketSearch.addEventListener('input', ()=> renderSymbolsGrid(marketsSymbolsGrid, marketSearch.value, activeCategory));

  /* Trading / Chart (uses TradingView widget if available) */
  let tradingWidget = null;
  function createTradingViewWidget(containerId, symbol){
    try {
      if(typeof TradingView === 'undefined'){
        document.getElementById(containerId).innerHTML = '<div style="padding:12px;color:var(--muted)">TradingView no disponible: carga la librería tv.js en el <head>.</div>';
        return null;
      }
      const cfg = {
        "autosize": true,
        "symbol": symbol,
        "interval": "15",
        "timezone": "Etc/UTC",
        "theme": "dark",
        "style": "1",
        "container_id": containerId,
        "allow_symbol_change": true,
        "hide_top_toolbar": false,
        "save_image": false,
        "details": true
      };
      return new TradingView.widget(cfg);
    } catch(e){
      document.getElementById(containerId).innerHTML = '<div style="padding:12px;color:var(--muted)">No se pudo cargar el chart en este entorno.</div>';
      return null;
    }
  }

  function initTradingWidget(symbol){
    const container = document.getElementById('tv_chart_container');
    if(!container) return;
    container.innerHTML = '';
    tradingWidget = createTradingViewWidget('tv_chart_container', symbol);
  }

  function selectSymbolAndOpenTrading(symbol, label){
    document.getElementById('tradingSymbol').innerText = (label || symbol.split(':').pop()).replace('_','/');
    document.getElementById('op-symbol').innerText = document.getElementById('tradingSymbol').innerText;
    document.getElementById('op-exchange').innerText = symbol.includes('OANDA') ? 'Market: FOREX' : (symbol.includes('INDEX') ? 'Market: INDEX' : 'Market: EXCHANGE');
    currentSymbol = symbol;
    showPanel('tradingPanel');
    initTradingWidget(symbol);
    updateDisplayedPrice(symbolPrices[symbol] || '--');
    updateOrderBook(symbolPrices[symbol] || 0);
  }

  /* Price engine removed: los precios deben venir del backend o websocket */
  function updateDisplayedPrice(price){
    if(!isFinite(price)) {
      opPriceEl.innerText = '--';
      return;
    }
    opPriceEl.innerText = (Math.abs(price) > 1000) ? price.toLocaleString(undefined,{maximumFractionDigits:1}) : Number(price).toFixed(6);
  }

  function updateOrderBook(base){
    if(!base || !isFinite(base)) {
      if(obBidsEl) obBidsEl.innerHTML = '<div style="color:var(--muted)">— sin datos —</div>';
      if(obAsksEl) obAsksEl.innerHTML = '<div style="color:var(--muted)">— sin datos —</div>';
      return;
    }
    let bidsHtml = '', asksHtml = '';
    for(let i=0;i<8;i++){
      bidsHtml += `<div class="ob-row"><span style="color:var(--gold)">${(base - (i+1)*(base*0.0008)).toFixed(6)}</span><span>${(Math.random()*3).toFixed(6)} ${getBaseUnit()}</span></div>`;
      asksHtml += `<div class="ob-row"><span>${(Math.random()*3).toFixed(6)} ${getBaseUnit()}</span><span style="color:var(--muted)">${(base + (i+1)*(base*0.0008)).toFixed(6)}</span></div>`;
    }
    if(obBidsEl) obBidsEl.innerHTML = bidsHtml;
    if(obAsksEl) obAsksEl.innerHTML = asksHtml;
  }

  function getBaseUnit(){
    const lab = document.getElementById('tradingSymbol').innerText || '';
    return lab.split('/')[0] || '';
  }

  /* Orders / Positions */
  let currentSymbol = ALL_SYMBOLS[0].symbol;

  /* createOrder ahora intenta usar backend si hay token; si no, solicita iniciar sesión.
     así pasas de demo a real sin eliminar la UI */
  document.getElementById('btnBuy').addEventListener('click', ()=> createOrder('BUY'));
  document.getElementById('btnSell').addEventListener('click', ()=> createOrder('SELL'));

  async function createOrder(side){
    const type = document.getElementById('order-type').value;
    const qty = parseFloat(document.getElementById('order-qty').value);
    const price = parseFloat(document.getElementById('order-price').value);

    if(!qty || qty <= 0){ alert('Cantidad inválida'); return; }

    // si hay token, enviamos al backend
    const token = localStorage.getItem('token');
    if(token){
      try{
        const res = await fetch(`${API_URL}/trade/open`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': token
          },
          body: JSON.stringify({ symbol: currentSymbol, qty, price: isFinite(price)?price:null, side, type })
        });
        if(res.ok){
          const d = await res.json().catch(()=>null);
          alert('Orden enviada al backend.');
          // opcional: refrescar posiciones/ wallet desde backend
          try{ updateFromBackend(); }catch(e){}
        } else {
          const text = await res.text().catch(()=>null);
          alert('Error al enviar orden: ' + (text || res.status));
        }
      } catch(e){
        console.error('createOrder error', e);
        alert('No se pudo conectar con el backend. Revisa tu conexión.');
      }
      return;
    }

    // si no hay token, pedimos login (no ejecutamos demo)
    alert('Debes iniciar sesión para operar. Usa el login real desde el panel.');
  }

  function renderOrders(){
    if(!ordersListEl) return;
    if(pendingOrders.length === 0){
      ordersListEl.innerHTML = '<div>— no hay órdenes —</div>';
      return;
    }
    ordersListEl.innerHTML = '';
    pendingOrders.slice().reverse().forEach(o=>{
      const div = document.createElement('div');
      div.style.padding='6px';
      div.style.borderBottom='1px solid rgba(255,255,255,0.02)';
      div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${o.type}</strong> ${o.side} ${o.qty} ${getBaseFromSymbol(o.symbol)}</div><div style="color:var(--muted)">${o.symbol}</div></div>
        <div style="display:flex;justify-content:flex-end;margin-top:6px;gap:8px">
          <button class="btn-secondary" onclick="cancelOrder('${o.id}')">Cancelar</button>
        </div>`;
      ordersListEl.appendChild(div);
    });
  }

  function cancelOrder(id){
    pendingOrders = pendingOrders.filter(o=>o.id !== id);
    renderOrders();
  }

  /* NOTE: executeMarketOrder / closePosition / etc se mantienen por compatibilidad,
     pero la lógica real de ejecución debe venir del backend. */
  function executeMarketOrder(order){
    console.warn('executeMarketOrder: operación local no permitida en modo real. Usa backend.');
  }

  function getBaseFromSymbol(symbol){
    if(symbol.includes(':')){
      const after = symbol.split(':')[1];
      if(after.includes('_')) return after.split('_')[0];
      if(after.includes('USDT')) return after.replace(/USDT.*$/,'').replace(/[^A-Za-z]/g,'');
      return after.split('/')[0] || after;
    }
    return symbol;
  }
  function formatPrice(p){ if(!isFinite(p)) return p; if(Math.abs(p) > 1000) return p.toLocaleString(undefined,{maximumFractionDigits:1}); return p.toFixed(6); }

  function renderPositionsUI(){
    const container = document.getElementById('positionsList');
    if(!container) return;

    container.innerHTML = '';

    if(positions.length === 0){
      container.innerHTML = `
        <div style="color:var(--muted);font-size:13px;padding:12px;text-align:center">
          No hay posiciones abiertas
        </div>
      `;
    } else {
      positions.forEach(p=>{
        const price = symbolPrices[p.symbol] || p.entryPrice || 0;
        const unreal = (price - (p.entryPrice||0)) * p.qty;

        const el = document.createElement('div');
        el.className = 'pos-card';
        el.onclick = ()=> openPosition(p.id);

        el.innerHTML = `
          <div>
            <div style="font-weight:700">${p.symbol}</div>
            <div style="color:var(--muted);font-size:13px">
              qty ${p.qty} • entrada ${formatPrice(p.entryPrice||0)}
            </div>
          </div>

          <div style="text-align:right">
            <div style="font-weight:800;color:${unreal >= 0 ? 'var(--gold)' : 'var(--danger)'}">
              ${unreal >= 0 ? '+' : ''}${formatPrice(unreal)}
            </div>
            <div class="muted-small">PnL</div>
          </div>
        `;

        container.appendChild(el);
      });
    }

    if(posCountEl) posCountEl.innerText = positions.length;
    if(posCountTop) posCountTop.innerText = positions.length;
  }

  function openPosition(positionId){
    const pos = positions.find(p=>p.id === positionId);
    if(!pos) { alert('Posición no encontrada'); return; }
    selectSymbolAndOpenTrading(pos.symbol, pos.symbol.replace(/.*:/,''));
  }

  function closePosition(id){
    alert('Cerrar posición desde UI debe pedirse al backend. Implementa endpoint para cerrar posiciones.');
  }

  function updateWalletTotal(){
    // show 0 by default; backend should update real values
    if(balUsdtEl) balUsdtEl.innerText = demo_usdt.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
    if(balUsdtTop) balUsdtTop.innerText = demo_usdt.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
    let total = demo_usdt;
    Object.keys(demo_balances).forEach(k=>{
      const sym = findSymbolForBase(k);
      const qty = demo_balances[k] || 0;
      total += (symbolPrices[sym] || 0) * qty;
    });
    if(balanceTotalEl) balanceTotalEl.innerText = '$' + total.toLocaleString(undefined,{maximumFractionDigits:2});
    const cashAvailEl = document.getElementById('cashAvail');
    if(cashAvailEl) cashAvailEl.innerText = '$' + demo_usdt.toLocaleString(undefined,{maximumFractionDigits:2});
  }

  function findSymbolForBase(base){
    if(base === 'BTC') return 'BINANCE:BTCUSDT';
    if(base === 'ETH') return 'BINANCE:ETHUSDT';
    if(base === 'SOL') return 'BINANCE:SOLUSDT';
    if(base === 'EUR') return 'OANDA:EUR_USD';
    if(base === 'GBP') return 'OANDA:GBP_USD';
    return 'BINANCE:BTCUSDT';
  }

  function initTradingIfNeeded(){
    initTradingWidget(currentSymbol);
    updateDisplayedPrice(symbolPrices[currentSymbol]||'--');
    updateOrderBook(symbolPrices[currentSymbol]||0);
    renderOrders();
    renderPositionsUI();
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    showPanel('dashboardPanel');
    // no seed demo positions by default — si quieres datos de prueba, el admin los inyecta
    renderPositionsUI();
    updateWalletTotal();
    renderOrders();
  });

  function logout(){ if(confirm('¿Cerrar sesión?')) { performLogoutFull(); } }
  function submitTransaction(e){ e.preventDefault(); alert('Solicitud enviada.'); e.target.reset(); }
  function submitDoc(e){ e.preventDefault(); alert('Documento enviado.'); e.target.reset(); }

  // ---------------------------
  // controladores para backend
  // ---------------------------
  const API_URL = "http://localhost:3000/api"; // ajusta a producción

  async function loginUser(email, password){
    try{
      const res = await fetch(`${API_URL}/auth/login`,{
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ email, password })
      });
      if(!res.ok) { alert('Error en login'); return null; }
      const data = await res.json();
      if(data.token){
        localStorage.setItem('token', data.token);
        alert('Login correcto');
        // opcional: pedir datos del usuario y mostrar
        if(data.user){
          document.getElementById('privateHeaderName').innerText = data.user.name || data.user.email || 'Usuario';
          document.getElementById('privateWelcomeName').innerText = data.user.name || data.user.email || 'Usuario';
          document.getElementById('headerAvatar').innerText = (data.user.name||'U').charAt(0).toUpperCase();
        }
        return data;
      } else {
        alert('Credenciales incorrectas');
        return null;
      }
    } catch(e){
      console.error('loginUser error', e);
      alert('No se pudo conectar con el backend.');
      return null;
    }
  }

  async function getMyWallet(){
    const token = localStorage.getItem('token');
    if(!token) { console.warn('No token'); return null; }
    try{
      const res = await fetch(`${API_URL}/wallet/me`,{
        headers:{ 'Authorization': token }
      });
      if(!res.ok) { console.warn('wallet fetch error', res.status); return null; }
      const data = await res.json();
      console.log('Saldo:', data.balance);
      // el admin puede devolver y aquí actualizamos la UI:
      if(data.balance !== undefined){
        demo_usdt = Number(data.balance) || 0;
        updateWalletTotal();
      }
      return data;
    } catch(e){
      console.error('getMyWallet error', e);
      return null;
    }
  }

  async function openTrade(symbol, qty, price){
    const token = localStorage.getItem('token');
    if(!token) throw new Error('No token');
    const res = await fetch(`${API_URL}/trade/open`,{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization': token
      },
      body: JSON.stringify({ symbol, qty, price })
    });
    return res;
  }

  // helper: intentar actualizar posiciones/saldo desde backend (si existen endpoints)
  async function updateFromBackend(){
    try{
      await getMyWallet();
      // puedes agregar fetch para posiciones, órdenes, etc.
    }catch(e){}
  }

  </script>
  <!-- END: contenido importado -->
</div>

<!-- ================= FIN PARTE PRIVADA COMPLETA ================= -->

</body>
</html>
